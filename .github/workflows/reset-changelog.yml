name: Reset Changelog After Release Merge

on:
  push:
    branches:
      - release

jobs:
  reset-changelog:
    if: ${{ !contains(join(github.event.commits.*.modified, ','), 'CHANGELOG.md') }}
    runs-on: ubuntu-latest

    steps:
      - name: Checkout release branch
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PRIVATE_TOKEN }}
          ref: release

      - name: Clear CHANGELOG.md
        run: echo "" > CHANGELOG.md

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.PRIVATE_TOKEN }}
          commit-message: "chore: Reset changelog"
          title: "chore: Reset changelog"
          body: |
            This PR resets the `CHANGELOG.md` file after a release merge.
            It is automatically generated and targets the `release` branch.
          branch: reset-changelog
          base: release
          labels: auto-generated
          committer: WynntilsBot <admin@wynntils.com>
